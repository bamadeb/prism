{% extends 'basic.html' %}
{% load static %}
{% block body %}
<style>
    .red{

    border-radius: 50%;
    background-color: red;
    width: 14px;
    height: 14px;
    }
    .parent {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .green{

        border-radius: 50%;
        background-color: green;
        width: 14px;
        height: 14px;
    }
    #members thead tr:first-child th {
      /* background-color: #f2f2f2;*/
      text-align: center;
      font-weight: bold;
      border-bottom: none !important;
      padding: 0 !important;
    }
  /* Style for the grouped headers */
  .group-header th {
    /* background-color: #f5f5f5; */
    text-align: center;
    font-weight: bold;
    position: relative;
    border-bottom: none !important;
  }

  /* Contact Info group box */
  .group-contact {
    border: 2px solid #4CAF50;
    border-bottom: none; /* Avoid double border with lower row */
  }

  /* Performance group box */
  .group-performance {
    border: 2px solid #2196F3;
    border-bottom: none;
  }

  /* Optional: Style for ungrouped column */
  .no-group {
    border: 2px solid #ccc;
    border-bottom: none;
  }
    /* Remove top border from the second header row */
    #members thead tr:not(.group-header) th {
      border-top: none !important;
    }
    .group-performance-td {
    border-left: 2px solid #d3cfcf !important;
    }
</style>
<main id="main" class="main" style="margin-top:50px!important;min-height:550px;">
    <section class="section dashboard">

        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <div id="accordion" class=" mb-0">
                            <div id="headingThree">
                                <h3 class="mb-0 mt-0 text-center">
                                    <button style="    font-size: 18px; color:#000;" class="btn btn-link collapsed" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        PROJECT OVERVIEW
                                    </button>
                                </h3>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">
                                <div class="col-xl-6 col-sm-6 mb-xl-0">
                                    <div class="row">
                                        <div class="col-3 text-center text-uppercase"><h4 style="text-decoration:underline;    font-weight: bold !important;">RISK</h4> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Gaps</h5> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Completed</h5> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Performance</h5> </div>

                                        <div class="col-3 text-center text-uppercase"><h4>Overall</h4></div>
                                        <div class="col-3 text-center"><h4>{{ overallSummary.risk_count }}</h4></div>
                                        <div class="col-3 text-center"><h4>{{ overallSummary.risk_comp_count }}</h4> </div>
                                        <div class="col-3 text-center"><h4 style="color: {{ overallSummary.risk_perf_color }}">{{ overallSummary.risk_perf|floatformat:0 }}% </h4></div>

                                        <div class="col-3 text-center text-uppercase"><h4>My Own</h4></div>
                                        <div class="col-3 text-center"><h4>{{ ownSummary.risk_count }}</h4></div>
                                        <div class="col-3 text-center"><h4>{{ ownSummary.risk_comp_count }}</h4> </div>
                                        <div class="col-3 text-center"><h4 style="color: {{ ownSummary.risk_perf_color }}">{{ ownSummary.risk_perf|floatformat:0 }}% </h4></div>
                                    </div>
                                    <div class="row">
                                        <div class="col-3 text-center text-uppercase"><h4 style="text-decoration:underline;    font-weight: bold !important;">QUALITY</h4> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Gaps</h5> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Completed</h5> </div>
                                        <div class="col-3 text-center text-uppercase"><h5>Performance</h5> </div>

                                        <div class="col-3 text-center text-uppercase"><h4>Overall</h4></div>
                                        <div class="col-3 text-center"><h4>{{ overallSummary.quality_count }}</h4></div>
                                        <div class="col-3 text-center"><h4>{{ overallSummary.quality_comp_count }}</h4> </div>
                                        <div class="col-3 text-center"><h4 style="color: {{ overallSummary.quality_perf_color }}">{{ overallSummary.quality_perf|floatformat:0 }}% </h4></div>

                                        <div class="col-3 text-center text-uppercase"><h4>My Own</h4></div>
                                        <div class="col-3 text-center"><h4>{{ ownSummary.quality_count }}</h4></div>
                                        <div class="col-3 text-center"><h4>{{ ownSummary.quality_comp_count }}</h4> </div>
                                        <div class="col-3 text-center"><h4 style="color: {{ ownSummary.quality_perf_color }}">{{ ownSummary.quality_perf|floatformat:0 }}% </h4></div>
                                    </div>
                                </div>
                                <div class="col-xl-6 col-sm-6 mb-xl-0">
                                    <table class="table">
                                        <tr>
                                            <th><h4 class="text-uppercase" style="text-decoration:underline;    font-weight: bold !important;">WORK OVERVIEW</h4></th>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <th><h5>{{ vals.provider_name }}</h5></th>
                                            {% endfor %}
                                            {% endfor %}
                                            <th><h5>TOTAL</h5></th>
                                        </tr>

                                        <tr>
                                            <td>CONTACTED (PRIORITY)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.call_count }}/{{ vals.priority_count }} (<span style="color:{{ vals.priority_color }}">{{ vals.priority_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_call_count|floatformat:0 }}/{{ totalArray.total_priority_count|floatformat:0 }} (<span style="color:{{ totalArray.priority_call_color }}">{{ totalArray.priority_call_percentage|floatformat:0 }}%</span>)</td>
                                        </tr>
                                        <tr>
                                            <td>CONTACTED (OTHERS)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.other_call_count }}/{{ vals.other_count }} (<span style="color:{{ vals.other_call_color }}">{{ vals.other_call_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_other_call_count|floatformat:0 }}/{{ totalArray.total_other_count|floatformat:0 }} (<span style="color:{{ totalArray.other_call_color }}">{{ totalArray.other_call_percentage|floatformat:0 }}%</span>)</td>
                                        </tr>
                                        <tr>
                                            <td colspan="{{ performancArray|length|add:2 }}" style="border-top: 2px solid #000; padding: 0; margin: 0; line-height: 0;"></td>
                                        </tr>
                                        <tr>
                                            <td>RISK GAPS (PRIORITY)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.priority_complete_gaps_count }}/{{ vals.priority_gaps_count }} (<span style="color:{{ vals.priority_gaps_color }}">{{ vals.priority_gaps_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_priority_complete_gaps_count|floatformat:0 }}/{{ totalArray.total_priority_gaps_count|floatformat:0 }} (<span style="color:{{ totalArray.priority_gaps_color }}">{{ totalArray.priority_gaps_percentage|floatformat:0 }}%</span>)</td>

                                        </tr>
                                        <tr>
                                            <td>RISK GAPS (OTHERS)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.other_complete_gaps_count }}/{{ vals.other_gaps_count }} (<span style="color:{{ vals.other_gaps_color }}">{{ vals.other_gaps_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_other_complete_gaps_count|floatformat:0 }}/{{ totalArray.total_other_gaps_count|floatformat:0 }} (<span style="color:{{ totalArray.other_gaps_color }}">{{ totalArray.other_gaps_percentage|floatformat:0 }}%</span>)</td>

                                        </tr>
                                        <tr>
                                            <td colspan="{{ performancArray|length|add:2 }}" style="border-top: 2px solid #000; padding: 0; margin: 0; line-height: 0;"></td>
                                        </tr>
                                        <tr>
                                            <td>QUALITY GAPS (PRIORITY)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.priority_complete_quality_gaps_count }}/{{ vals.priority_quality_gaps_count }} (<span style="color:{{ vals.priority_gaps_color }}">{{ vals.priority_quality_gaps_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_priority_complete_quality_gaps_count|floatformat:0 }}/{{ totalArray.total_priority_quality_gaps_count|floatformat:0 }} (<span style="color:{{ totalArray.priority_gaps_color }}">{{ totalArray.priority_quality_gaps_percentage|floatformat:0 }}%</span>)</td>

                                        </tr>
                                        <tr>
                                            <td>QUALITY GAPS (OTHERS)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.other_complete_quality_gaps_count }}/{{ vals.other_quality_gaps_count }} (<span style="color:{{ vals.other_gaps_color }}">{{ vals.other_quality_gaps_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.total_other_complete_quality_gaps_count|floatformat:0 }}/{{ totalArray.total_other_quality_gaps_count|floatformat:0 }} (<span style="color:{{ totalArray.other_gaps_color }}">{{ totalArray.other_quality_gaps_percentage|floatformat:0 }}%</span>)</td>

                                        </tr>
                                        <tr>
                                            <td colspan="{{ performancArray|length|add:2 }}" style="border-top: 2px solid #000; padding: 0; margin: 0; line-height: 0;"></td>
                                        </tr>

                                        <tr>
                                            <td>PCP VISIT (PRIORITY)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.priority_pcp_visit_count }}/{{ vals.priority_count }} (<span style="color:{{ vals.priority_pcp_visit_color }}">{{ vals.priority_pcp_visit_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.priority_pcp_visit_count|floatformat:0 }}/{{ totalArray.total_priority_count|floatformat:0 }} (<span style="color:{{ totalArray.priority_pcp_color }}">{{ totalArray.priority_pcp_percentage|floatformat:0 }}%</span>)</td>
                                        </tr>
                                        <tr>
                                            <td>PCP VISIT (OTHERS)</td>
                                            {% for item in performancArray %}
                                            {% for pcp_id, vals in item.items %}
                                            <td>{{ vals.other_pcp_visit_count }}/{{ vals.other_count }} (<span style="color:{{ vals.other_pcp_visit_color }}">{{ vals.other_pcp_visit_percentage|floatformat:0 }}%</span>)</td>
                                            {% endfor %}
                                            {% endfor %}
                                            <td>{{ totalArray.other_pcp_visit_count|floatformat:0 }}/{{ totalArray.total_other_count|floatformat:0 }} (<span style="color:{{ totalArray.other_pcp_color }}">{{ totalArray.other_pcp_percentage|floatformat:0 }}%</span>)</td>
                                        </tr>


                                    </table>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Left side columns -->
            <div class="col-lg-12">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body">

                                <!-- Nav Tabs -->
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="true">MEMBERS</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="home-tab" data-bs-toggle="tab" data-bs-target="#home" type="button" role="tab" aria-controls="task" aria-selected="false">TASKS</button>
                                    </li>
                                </ul>
                                <!--        <ul class="nav nav-tabs" id="myTab" role="tablist">-->
                                <!--          <li class="nav-item" role="presentation">-->
                                <!--            <button class="nav-link active" id="profile-tab" data-toggle="tab" data-target="#profile" type="button" role="tab" aria-controls="profile" aria-selected="true">MEMBERS</button>-->
                                <!--          </li>-->
                                <!--          <li class="nav-item" role="presentation">-->
                                <!--            <button class="nav-link" id="home-tab" data-toggle="tab" data-target="#home" type="button" role="tab" aria-controls="task" aria-selected="false">TASKS</button>-->
                                <!--          </li>-->
                                <!--          <li class="nav-item" role="presentation">-->
                                <!--            <button class="nav-link" id="referred-tab" data-toggle="tab" data-target="#referred" type="button" role="tab" aria-controls="referred" aria-selected="false">TRANSFERRED LIST</button>-->
                                <!--          </li>-->
                                <!--          <li class="nav-item" role="presentation">-->
                                <!--            <button class="nav-link" id="transportation-tab" data-toggle="tab" data-target="#transportation" type="button" role="tab" aria-controls="transportation" aria-selected="false">TRANSPORTATION LIST</button>-->
                                <!--          </li>-->
                                <!--        </ul>-->

                                <div class="tab-content pt-2" id="myTabContent">

                                    <!-- TASKS TAB -->
                                    <div class="tab-pane " id="home" role="tabpanel" aria-labelledby="home-tab">
                                        <table class="table table-borderless" id="tasks">
                                            <thead>
                                            <tr>
                                                <th width="5%"></th>
                                                <th>DATE</th>
                                                <th>STATUS</th>
                                                <th>ASSIGN TO</th>
                                                <th>ADDED BY</th>
                                                <th style="text-align:center;">COMPLETED DATE</th>
                                                <th align="center">ACTION</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for task in task_list %}


                                            <tr class="gradeX trbg">
                                                <td align="center">
                                                    <div style="border-radius:50%;
              background-color:{{ task.color }};
              width:14px;height:14px;">
                                                    </div>
                                                </td>

                                                <td>{% if task.action_date %}{{ task.action_date|date:"m/d/Y" }}{% endif %}</td>
                                                <td><a href="javascript:void(0);">{{ task.status }}</a></td>
                                                <td>{{ task.FistName }} {{ task.LastName }}</td>
                                                <td align="center">{{ task.initial }}</td>
                                                <td align="center">{{ task.completed_date }}</td>
                                                <td>
                                                    {% if task.status != "Successful" and task.status != "Close" %}
                                                    <a style="cursor:pointer;" title="Action Change" data-toggle="modal" data-backdrop="static" data-target="#action_change"
                                                       onclick="action_change('Update','{{ task.action_date|date:'m/d/Y' }}','{{ task.id }}','{{ task.status }}','{{ task.action_note }}','{{ task.assign_to }}','{{ task.medicaid_id }}');">
                                                        <i class="bi bi-pencil" aria-hidden="true"></i>
                                                    </a>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- MEMBERS TAB -->
                                    <div class="tab-pane show active" id="profile" role="tabpanel" aria-labelledby="profile-tab">
                                        <table class="table table-sm table-borderless" id="members">
                                            <thead>
                                            <tr class="group-header">
                                                <th colspan="7"></th>
                                                <th colspan="3" class="group-performance-td">RISK GAPS</th>
                                                <th colspan="3" class="group-performance-td">QUALITY GAPS</th>
                                                <th class="group-performance-td"></th>
                                            </tr>
                                            <tr>
                                                <th>#MEMBER ID</th>
                                                <th>NAME/PHONE</th>
                                                <th class="text-center">PCP</th>
                                                <!--                                                <th>ALERT</th>-->
                                                <th class="text-center">PRIORITY</th>
                                                <th class="text-center">#TASK</th>
                                                <th class="text-center">#CALL</th>
                                                <th></th>
                                                <!--                                                <th>ELIGIBILITY</th>-->
                                                <th class="text-center group-performance-td">COUNT</th>
                                                <th class="text-center">COMPLETED</th>
                                                <th class="text-center">%</th>
                                                <th class="text-center group-performance-td">COUNT</th>
                                                <th class="text-center">COMPLETED</th>
                                                <th class="text-center">%</th>
                                                <th align="right " class="group-performance-td">ACTION</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for member in members %}
                                            <tr>
                                                <th class="text-primary"> #{{ member.medicaid_id }}</th>
                                                <td class="text-primary" style="text-transform:uppercase;">{{ member.FIRST_NAME }} {{ member.LAST_NAME }}<br>{{ member.OTHER_PHONE|default:'' }}</td>
                                                <td class="text-center parent" ><div class="{% if member.PCP_VISIT_FLAG == 1 %}green{% else %}red{% endif %}"></div></td>
                                                <td class="text-center">{{ member.PRIORITY_FLAG|default:"" }}</td>
                                                <td class="text-center"><a  href="javascript:void(0);" onclick="add_update_task_click('{{ member.medicaid_id }}','{{ member.FIRST_NAME }}','{{ member.LAST_NAME }}');">{{ member.task_count }}</a></td>
                                                <td class="text-center">
                                                    <a title="Call List" class="text-primary" style="cursor:pointer;" onclick="showCallList('{{ member.medicaid_id }}','{{ member.FIRST_NAME }} {{ member.LAST_NAME }}');">
                                                        {{ member.Call_count }}
                                                    </a>
                                                </td>
                                                <td></td>
                                                <td class="text-center group-performance-td">
                                                    <a title="Gap List" class="text-primary" style="cursor:pointer;" onclick="showGapList('{{ member.medicaid_id }}','{{ member.FIRST_NAME }} {{ member.LAST_NAME }}');">
                                                        {{ member.risk_gap_count }}
                                                    </a>
                                                </td>
                                                <td class="text-center">{{ member.risk_comp_count }}</td>
                                                <td class="text-center" style="color: {{ member.risk_perf_color }}">{{ member.risk_perf|floatformat:0 }}%</td>

                                                <td class="text-center group-performance-td">
                                                    <a title="CIH Quality List" class="text-primary" style="cursor:pointer;" onclick="showCIHQualityList('{{ member.medicaid_id }}','{{ member.FIRST_NAME }} {{ member.LAST_NAME }}');">
                                                        {{ member.quality_count }}
                                                    </a>
                                                </td>
                                                <td class="text-center">{{ member.quality_comp_count }}</td>
                                                <td class="text-center" style="color: {{ member.quality_perf_color }}">{{ member.quality_perf|floatformat:0 }}%</td>
                                                <td class="text-center group-performance-td" >

                                                    <a target="_blank" href="{% url 'memberdetails' member.medicaid_id %}">
                                                        <i title="Member Details" class="fa fa-eye"></i>
                                                    </a>&nbsp;&nbsp;
                                                    <a  href="javascript:void(0);" onclick="add_update_action_click('{{ member.medicaid_id }}','{{ member.FIRST_NAME }}','{{ member.LAST_NAME }}');">
                                                        <i title="Add Action" class="fa fa-plus"></i>
                                                    </a>&nbsp;&nbsp;
                                                    <!--                                                    <a target="_blank" href="{% url 'history' member.medicaid_id %}">-->
                                                    <!--                                                        <i title="Member History" class="fa fa-history"></i></a>-->
                                                    <!--                                                    &nbsp;&nbsp;-->
                                                    <!--                                                    <a href="javascript:void(0);" onclick="addAction('{{ member.medicaid_id }}');" class="text-primary">+<i class="fa fa-phone"></i></a>-->
                                                    <!--                                               -->
                                                </td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- REFERRED LIST TAB -->
                                    <div class="tab-pane " id="referred" role="tabpanel" aria-labelledby="referred-tab">
                                        <table class="table table-borderless" id="transferList">
                                            <thead>
                                            <tr>
                                                <th>#MEMBER ID</th>
                                                <th>TRANSFERRED BY</th>
                                                <th>TRANSFERRED TO</th>
                                                <th>TRANSFER DATE</th>
                                                <th>TRANSFER REASON</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for ref in refared_member_list %}
                                            <tr>
                                                <td><a href="javascript:void(0);">#{{ ref.medicaid_id }}</a></td>
                                                <td>{{ ref.user_name }}</td>
                                                <td>{{ ref.medical_user }}</td>
                                                <td>{% if ref.add_date %}{{ ref.add_date|date:"m/d/Y" }}{% endif %}</td>
                                                <td>{{ ref.referring_reason }}</td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>

                                    <!-- TRANSPORTATION TAB -->
                                    <div class="tab-pane " id="transportation" role="tabpanel" aria-labelledby="transportation-tab">
                                        <table class="table table-striped table-bordered" id="transportation_prior_list_table_id">
                                            <thead>
                                            <tr>
                                                <th>MEMBER ID</th>
                                                <th>FIRST NAME</th>
                                                <th>LAST NAME</th>
                                                <th>PHONE</th>
                                                <th>ADDRESS</th>
                                                <th>DATE & TIME</th>
                                                <th>VENDOR</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for transport in all_3day_transport_list %}
                                            <tr>
                                                <td>{{ transport.medicaid_id }}</td>
                                                <td>{{ transport.FIRST_NAME }}</td>
                                                <td>{{ transport.LAST_NAME }}</td>
                                                <td>{{ transport.HOME_PHONE }}</td>
                                                <td>{{ transport.ADDR1 }}</td>
                                                <td>
                                                    {% if transport.action_date %}{{ transport.action_date|date:"m/d/Y" }}{% endif %}
                                                    ({{ transport.action_time }})
                                                </td>
                                                <td>{{ transport.schedule_type }}</td>
                                            </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>
                                    </div>
                                </div><!-- End tab-content -->
                            </div>
                        </div>
                    </div>
                </div>
            </div><!-- End Left side columns -->

            <div class="col-lg-6">
                <!-- Recent Activity -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Recent Activity <span>| Today</span></h5>
                        <div class="activity">
                            {% for recent in recent_activity %}

                            <div class="activity-item row">
                                <div class="activite-label col-lg-4">
                                    {{ recent.add_date|date:"M d Y H:i" }}
                                </div>
                                <div class="col-lg-1">
                                    <i class="bi bi-circle-fill activity-badge text-primary align-self-start"></i>
                                </div>
                                <div class="activity-content col-lg-7">
                                    #{{ recent.medicaid_id }}: {{ recent.log_name }}, {{ recent.log_details }}
                                </div>
                            </div> <!-- End activity item-->
                            {% endfor %}
                        </div>
                    </div>
                </div><!-- End Recent Activity -->
            </div>

            <!-- Right side columns -->
            <div class="col-lg-6">
                <!-- Alerts -->
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Alerts <span>| Today</span></h5>
                        <div class="activity">
                            <div class="row">
                                {% for alert in alert_count %}
                                <div class="col-lg-4 mt-2 py-3" style="border-bottom: 1px solid #ccc;">
                                    {{ alert.alert }}
                                </div>
                                <div class="col-lg-2 mb-3" style="border-bottom: 1px solid #ccc;">
                                    <span class="badge alert_bg1">{{ alert.alert_count }}</span>
                                </div>
                                {% endfor %}

                                {# If odd number of alerts, add blank columns #}
                                {% if alert_count|length|divisibleby:2 == False %}
                                <div class="col-lg-4 mt-2 mb-3" style="border-bottom: 1px solid #ccc;"></div>
                                <div class="col-lg-2 mb-3" style="border-bottom: 1px solid #ccc;"></div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div><!-- End Recent Activity -->
            </div><!-- End Right side columns -->

        </div>
    </section>
</main>
<!-- Loder HTML -->
<div id="gapLoader"
     style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
            background:rgba(0,0,0,0.3); z-index:9999; text-align:center; padding-top:20%;">
    <div class="spinner-border text-primary" role="status" style="width:3rem; height:3rem;">
        <span class="visually-hidden">Loading...</span>
    </div>
</div>

{% include "include/addactionmodal.html" %}
{% include "include/taskmodal.html" %}
<!-- Call list modal start -->
<div class="modal " id="callList" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title text-uppercase">CALL LIST - <span id="nameCallList"></span> (#<span id="idCallList"></span>)</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-sm">
                    <thead>
                    <tr>
                        <th>Sl.No</th>
                        <th>DATE</th>
                        <th>ACTION</th>
                        <th>OUTCOME</th>
                        <th>NOTE</th>
                    </tr>
                    </thead>
                    <tbody id="callList_table_body">
                    <!-- dynamically injected rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Call list modal end -->

<!-- Gap list modal start -->
<div class="modal " id="gapList" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title  text-uppercase"> GAP LIST - <span id="nameGapList"></span> (#<span id="idGapList"></span>)</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-sm">
                    <thead>
                    <tr>
                        <th></th>
                        <th>RELEVANT DATE</th>
                        <th>HCC CATEGORY</th>
                        <th>HCC MODEL</th>
                        <th>DIAG CODE</th>
                        <th>DIAG DESC</th>
                        <th>STATUS</th>
                    </tr>
                    </thead>
                    <tbody id="gapList_table_body">
                    <!-- dynamically injected rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Gap list modal start -->
<div class="modal " id="qualityList" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title text-uppercase">CIH QUALITY LIST - <span id="nameQualityList"></span> (#<span id="idQualityList"></span>)</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-sm">
                    <thead>
                    <tr>
                        <th></th>
                        <th>MEASURE NAME</th>
                        <th>SUB MEASURE</th>
                        <th>PROVIDER ID</th>
                        <th>PROVIDER NAME</th>
                        <th>STATUS</th>

                    </tr>
                    </thead>
                    <tbody id="quality_table_body">
                    <!-- dynamically injected rows -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<!-- Call list modal end -->

<!-- Add Action Modal Start -->
<div class="modal " id="largeModal" tabindex="-1" data-bs-backdrop="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fa fa-plus" aria-hidden="true"></i> Add Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card">
                    <div class="card-body">

                        <!-- Bordered Tabs -->
                        <ul class="nav nav-tabs nav-tabs-bordered" id="borderedTab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#bordered-home" type="button" role="tab">To-Do</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#bordered-profile" type="button" role="tab">Appointment</button>
                            </li>
                        </ul>

                        <div class="tab-content pt-2" id="borderedTabContent">

                            <!-- ================= To-Do Tab ================= -->
                            <div class="tab-pane  show active" id="bordered-home" role="tabpanel" aria-labelledby="home-tab">
                                <form method="post" enctype="multipart/form-data" id="add_action" onsubmit="return fileValidation();">
                                    {% csrf_token %}
                                    <input type="hidden" name="action_type_source" id="action_type_source" value="Visit">
                                    <input type="hidden" name="medicaid_id" id="medicaid_id">
                                    <input type="hidden" name="number_of_attempt" value="">
                                    <input type="hidden" name="visit_alertname" id="visit_alertname">
                                    <input type="hidden" name="action_type_name" id="action_type_name">

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-select" name="action_id" id="action_id" required onchange="set_scheduled_action_status(this.value);">
                                                <option value="">Activity Category</option>
                                                {% for region in sel_panel_list %}
                                                <option value="{{ region.id }}">{{ region.Panel_Name }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-select" name="panel_id" id="panel_id" required>
                                                <option value="">Activity Type</option>
                                                {% for type in sel_panel_type %}
                                                <option value="{{ type.id }}">{{ type.action_type }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input placeholder="Action Date" type="text" name="action_date" id="action_date" class="form-control datepicker" required>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-select" name="action_result_id" id="action_result_id" required>
                                                <option value="">Status</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-select" name="action_status" id="action_status" required>
                                                <option value="Scheduled">Scheduled</option>
                                                <option value="Success">Success</option>
                                                <option value="Failure">Failure</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <textarea class="form-control" name="action_note" id="action_note" required placeholder="Note"></textarea>
                                        </div>
                                    </div>

                                    {% if member_need_visit %}
                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <table width="100%">
                                                <tr>
                                                    <td>
                                                        <select class="form-select" name="visit_alert_id" id="visit_alert_id" onchange="get_visit_alert_name();">
                                                            <option value="">SELECT ALERT</option>
                                                            {% for visit in member_need_visit %}
                                                            <option value="{{ visit.alert_id }}/{{ visit.id }}">
                                                                {{ visit.alert }} ({{ visit.alert_type }} - {{ visit.created_date }})
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select class="form-select" name="visit_alert_status_id">
                                                            {% for alertStatus in alert_statusList %}
                                                            {% if alertStatus.id == 28 %}
                                                            <option value="{{ alertStatus.id }}">{{ alertStatus.alert_status }}</option>
                                                            {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    {% endif %}

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input class="form-control" type="file" name="file_visit_update" accept="application/pdf" disabled>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12" align="right">
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                            <!-- ================= Appointment Tab ================= -->
                            <div class="tab-pane " id="bordered-profile" role="tabpanel" aria-labelledby="profile-tab">
                                <form method="post" enctype="multipart/form-data" id="appoinmentment_add_action">
                                    {% csrf_token %}
                                    <input type="hidden" name="provider_id" id="provider_id">
                                    <input type="hidden" name="vendor_id" id="vendor_id">
                                    <input type="hidden" name="appointment_medicaid_id" id="appointment_medicaid_id">
                                    <input type="hidden" name="app_alertname" id="app_alertname">

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <div id="vendor_tab">
                                                <table width="100%">
                                                    <tr>
                                                        <td width="90%">
                                                            <input type='text' class="form-control" name="vendor_name" id="vendor_name" placeholder="Search Vendor">
                                                        </td>
                                                        <td width="10%">
                                                            <input type="button" class="btn btn-primary" value="Search" onclick="get_vendor_list();" style="margin-left: 10px;">
                                                        </td>
                                                    </tr>
                                                </table>
                                                <div style="float: left;display: none;" id="vendor_lebel"><b>Vendor List</b></div>
                                                <div style="clear:both;"></div>
                                            </div>
                                            <div id="vendor_replace_id" style="height: 120px;display: none; overflow-y: scroll;font-size: 14px;"></div>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <div id="doctor_id" style="display: none;">
                                                <table width="100%">
                                                    <tr>
                                                        <td width="90%">
                                                            <input type='text' class="form-control" name="doctor_name" id="doctor_name" placeholder="Search Doctor">
                                                        </td>
                                                        <td width="10%">
                                                            <input type="button" class="btn btn-primary" value="Search" onclick="get_doctor_list();" style="margin-left: 10px;">
                                                        </td>
                                                    </tr>
                                                </table>
                                                <div style="float: left;display: none;" id="doc_lebel"><b>Doctor List</b></div>
                                                <div style="clear:both;"></div>
                                            </div>
                                            <div id="replace_id" style="height: 120px;display: none; overflow-y: scroll;font-size: 14px;"></div>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input type='text' class="form-control datepicker" name="appointment_action_date" id="appointment_action_date" placeholder="Appointment Date" required>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input type='time' class="form-control" name="appointment_action_time" id="appointment_action_time" placeholder="Appointment Time">
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input type="text" name="place_of_appointment" id="place_of_appointment" class="form-control" placeholder="Place of Appointment">
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-control" name="transportation_needed" id="transportation_needed" required>
                                                <option value="">Transportation Needed</option>
                                                <option value="No">No</option>
                                                <option value="Yes">Yes</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <select class="form-control" name="appointment_action" id="appointment_action" required>
                                                <option value="Failure">Appointment Failure</option>
                                                <option value="Rescheduled">Appointment Rescheduled</option>
                                                <option value="Scheduled" selected>Appointment Scheduled</option>
                                                <option value="Success">Appointment Success</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <textarea class="form-control" name="appointment_action_note" id="appointment_action_note" required placeholder="Note"></textarea>
                                        </div>
                                    </div>

                                    {% if member_last_alert %}
                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <table width="100%">
                                                <tr>
                                                    <td>
                                                        <select class="form-control" name="app_alert_id" id="app_alert_id" onchange="get_alert_name();">
                                                            <option value="">SELECT ALERT</option>
                                                            {% for value in member_last_alert %}
                                                            <option value="{{ value.alert_id }}/{{ value.id }}">
                                                                {{ value.alert }} ({{ value.alert_type }} - {{ value.created_date }})
                                                            </option>
                                                            {% endfor %}
                                                        </select>
                                                    </td>
                                                    <td>
                                                        <select class="form-control" name="app_alert_status_id">
                                                            {% for alertStatus in alert_statusList %}
                                                            {% if alertStatus.id == 5 %}
                                                            <option value="{{ alertStatus.id }}">{{ alertStatus.alert_status }}</option>
                                                            {% endif %}
                                                            {% endfor %}
                                                        </select>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    {% endif %}

                                    <div class="row mb-3">
                                        <div class="col-sm-12">
                                            <input class="form-control" type="file" name="file_appointment" id="file_appointment" accept="application/pdf">
                                        </div>
                                    </div>

                                    <div class="row mb-3">
                                        <div class="col-sm-12" align="right">
                                            <button type="submit" class="btn btn-primary">Submit</button>
                                        </div>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Add Action Modal -->


<script type="text/javascript">
    $('#members').DataTable({
      order: [[7, 'DESC']],  // default sort on 4th column (index 3)
      columnDefs: [{
        targets: [6],  // hide multiple columns
        visible: false
      }]
  });
    $('#tasks').DataTable();
    $('#transferList').DataTable();
    $('#transportation_prior_list_table_id').DataTable();


function showCallList(medicaid_id, member_name) {
  if (medicaid_id) {
    // ✅ Show loader
    $("#gapLoader").show();

    $.ajax({
      type: "POST",
      url: "{% url 'get_call_history' %}",   // Django URL
      data: {
        medicaid_id: medicaid_id,
        csrfmiddlewaretoken: '{{ csrf_token }}'   // Django CSRF token
      },
      success: function (response) {
        if (response.statusCode === 200 && response.data.length > 0) {
          $("#callList_table_body").empty();

          response.data.forEach((row, i) => {
            let mydate = new Date(row.action_date);
            let action_date =
              (mydate.getMonth() + 1) + "/" + mydate.getDate() + "/" + mydate.getFullYear();

            let action_type = row.action_type ?? "";
            let action_result = row.action_result ?? "";
            let action_note = row.action_note ?? "";

            $("#callList_table_body").append(
              "<tr><td>" + (i + 1) + "</td>" +
              "<td>" + action_date + "</td>" +
              "<td>" + action_type + "</td>" +
              "<td>" + action_result + "</td>" +
              "<td>" + action_note + "</td></tr>"
            );
          });
        } else {
          $("#callList_table_body").html(
            "<tr><td colspan='5' class='text-center'>No records found</td></tr>"
          );
        }

        // ✅ Bootstrap 5 modal show
        $('#nameCallList').text(member_name);
        $('#idCallList').text(medicaid_id);
        var myModal = new bootstrap.Modal(document.getElementById('callList'));
        myModal.show();
      },
      error: function () {
        alert("Action Result Not found.");
      },
      complete: function () {
        // ✅ Always hide loader after request
        $("#gapLoader").hide();
      }
    });
  }
}


function showGapList(medicaid_id, member_name) {
  if (medicaid_id) {
    // ✅ Show loader
    $("#gapLoader").show();

    $.ajax({
      type: "POST",
      url: "{% url 'get_gap_list' %}",   // Django URL
      data: { medicaid_id: medicaid_id },
      success: function (response) {
        if (response.statusCode === 200 && response.data.length > 0) {
          $("#gapList_table_body").empty();

          response.data.forEach((row, i) => {
            let mydate = new Date(row.RELEVANT_DATE);
            let action_date =
              (mydate.getMonth() + 1) + "/" + mydate.getDate() + "/" + mydate.getFullYear();

            let DIAG_CODE = row.DIAG_CODE ?? "";
            let DIAG_DESC = row.DIAG_DESC ?? "";
            let HCC_CATEGORY = row.HCC_CATEGORY ?? "";
            let PROCESS_STATUS = row.PROCESS_STATUS ?? 0;
            let HCC_MODEL = row.HCC_MODEL ?? "";

            let STATUS_STR = PROCESS_STATUS == 1 ? "COMPLETE" : "OPEN";

            $("#gapList_table_body").append(
              "<tr><td>" + (i + 1) + "</td>" +
              "<td>" + action_date + "</td>" +
              "<td>" + HCC_CATEGORY + "</td>" +
              "<td>" + HCC_MODEL + "</td>" +
              "<td>" + DIAG_CODE + "</td>" +
              "<td>" + DIAG_DESC + "</td>" +
              "<td>" + STATUS_STR + "</td></tr>"
            );
          });
        } else {
          $("#gapList_table_body").html(
            "<tr><td colspan='7' class='text-center'>No records found</td></tr>"
          );
        }

        // ✅ Bootstrap 5 modal show
        $('#nameGapList').text(member_name);
        $('#idGapList').text(medicaid_id);
        var myModal = new bootstrap.Modal(document.getElementById('gapList'));
        myModal.show();
      },
      error: function () {
        alert("Action Result Not found.");
      },
      complete: function () {
        // ✅ Hide loader after success/error
        $("#gapLoader").hide();
      }
    });
  }
}
function showCIHQualityList(medicaid_id, member_name) {
  if (medicaid_id) {
    // ✅ Show loader
    $("#gapLoader").show();

    $.ajax({
      type: "POST",
      url: "{% url 'get_quality_list' %}",   // Django URL
      data: { medicaid_id: medicaid_id },
      success: function (response) {
        if (response.statusCode === 200 && response.data.length > 0) {
          $("#quality_table_body").empty();

          response.data.forEach((row, i) => {
            let MEASURE_NAME = row.MEASURE_NAME ?? "";
            let SUB_MEASURE = row.SUB_MEASURE ?? "";
            let PROVIDER_ID = row.PROVIDER_ID ?? "";
            let PROVIDER_NAME = row.PROVIDER_NAME ?? "";
            let PROCESS_STATUS = row.PROCESS_STATUS ?? 0;

            let STATUS_STR = PROCESS_STATUS == 1 ? "COMPLETE" : "OPEN";

            $("#quality_table_body").append(
              "<tr><td>" + (i + 1) + "</td>" +
              "<td>" + MEASURE_NAME + "</td>" +
              "<td>" + SUB_MEASURE + "</td>" +
              "<td>" + PROVIDER_ID + "</td>" +
              "<td>" + PROVIDER_NAME + "</td>" +
              "<td>" + STATUS_STR + "</td></tr>"
            );
          });
        } else {
          $("#quality_table_body").html(
            "<tr><td colspan='6' class='text-center'>No records found</td></tr>"
          );
        }

        // ✅ Bootstrap 5 modal show
        $('#nameQualityList').text(member_name);
        $('#idQualityList').text(medicaid_id);

        var myModal = new bootstrap.Modal(document.getElementById('qualityList'));
        myModal.show();
      },
      error: function () {
        alert("Action Result Not found.");
      },
      complete: function () {
        // ✅ Always hide loader after request
        $("#gapLoader").hide();
      }
    });
  }
}
     function addAction(medicaid_id) {
        //alert(medicaid_id);
        $('#action_id').val(5);
        $('#panel_id').val(2);
        $('#action_date').val('');
        $('#medicaid_id').val(medicaid_id)
        $('#appointment_medicaid_id').val(medicaid_id)
        $('#rsvp_appointment_medicaid_id').val(medicaid_id)
        //$('#medicaid_id').val(medicaid_id)
        $("#largeModal").modal('show');
      }

</script>
{% endblock %}

